#!/usr/bin/env node

const debug = require('node:util').debuglog('cnpm:update');
const path = require('node:path');
const { fork } = require('node:child_process');
const { rmSync } = require('node:fs');

const cwd = process.cwd();
const cnpmCli = path.join(__dirname, 'cnpm');
const options = {
  stdio: 'inherit',
};

const nodeModulesDir = path.join(cwd, 'node_modules');
console.log('[cnpm:update] Removing %s', nodeModulesDir);
rmSync(nodeModulesDir, { force: true, recursive: true });

console.log('[cnpm:update] Running "cnpm install" on %s', cwd);
fork(cnpmCli, [ 'install' ], options)
  .on('exit', code => {
    debug('exit %s', code);
    process.exit(code);
  });

